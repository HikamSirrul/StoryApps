const CACHE_NAME="storyapp-v5",STATIC_ASSETS=["/StoryApps/","/StoryApps/index.html","/StoryApps/manifest.json","/StoryApps/app.bundle.js","/StoryApps/app.css","/StoryApps/icons/icon-192.png","/StoryApps/icons/icon-512.png","/StoryApps/images/logo.png"];function isOSMTile(t){return/^https:\/\/[abc]\.tile\.openstreetmap\.org/.test(t)}self.addEventListener("install",(t=>{console.log("[SW] Installing..."),self.skipWaiting(),t.waitUntil(caches.open(CACHE_NAME).then((t=>Promise.all(STATIC_ASSETS.map((e=>fetch(e).then((n=>{if(!n.ok)throw new Error(`${e} not found`);return t.put(e,n)})).catch((t=>{console.warn(`[SW] Failed to cache ${e}:`,t.message)}))))))))})),self.addEventListener("activate",(t=>{console.log("[SW] Activating..."),t.waitUntil(caches.keys().then((t=>Promise.all(t.map((t=>{if(t!==CACHE_NAME)return console.log("[SW] Deleting old cache:",t),caches.delete(t)})))))),self.clients.claim()})),self.addEventListener("fetch",(t=>{const e=t.request;if("GET"!==e.method)return;const n=e.url,s=n.includes("dicoding.dev/v1"),o=new URL(n).origin!==self.location.origin;isOSMTile(n)?t.respondWith(caches.open("osm-tile-cache").then((t=>t.match(e).then((n=>{const s=fetch(e).then((n=>(200===n.status&&t.put(e,n.clone()),n))).catch((()=>n||new Response("",{status:503})));return n||s}))))):"image"===e.destination&&s?t.respondWith(caches.match(e).then((t=>t||fetch(e).then((t=>200===t.status?caches.open(CACHE_NAME).then((n=>(n.put(e,t.clone()),t))):t)).catch((()=>caches.match("/StoryApps/images/logo.png").then((t=>t||new Response("",{status:503})))))))):s||o||t.respondWith(caches.match(e).then((t=>t||fetch(e).then((t=>{if(!t||200!==t.status||"opaque"===t.type)return t;const n=t.clone();return caches.open(CACHE_NAME).then((t=>{new URL(e.url).origin===self.location.origin&&t.put(e,n)})),t})).catch((()=>"navigate"===e.mode?caches.match("/StoryApps/index.html"):"image"===e.destination?caches.match("/StoryApps/images/logo.png").then((t=>t||caches.match("/StoryApps/icons/icon-192.png"))).then((t=>t||new Response("",{status:404,statusText:"Not Found"}))):void 0)))))})),self.addEventListener("push",(t=>{console.log("[SW] Push received");const e=t.data?t.data.json():{},n=e.title||"Notifikasi Baru",s={body:e.body||"Ada update dari Story App!",icon:"/StoryApps/icons/icon-192.png",badge:"/StoryApps/icons/icon-192.png"};t.waitUntil(self.registration.showNotification(n,s))}));